---
layout: base.njk
---

<div class="note-header">
  <h1 class="note-title">
    {% if taxonomyType == "tags" %}
      <span class="list-icon">#</span>
    {% else %}
      <span class="list-icon">ðŸ“‚</span>
    {% endif %}
    {{ title }}
  </h1>
  <div class="note-meta">
    {% if taxonomyType == "tags" %}
      {% set untaggedCount = (collections.content | selectattr("data.tags", "undefined")).length %}
      <span class="note-count">å…± {{ (collections.tagList.length + (1 if untaggedCount > 0 else 0)) }} ä¸ªæ ‡ç­¾</span>
    {% else %}
      {% set uncategorizedCount = (collections.content | rejectattr("data.category")).length %}
      <span class="note-count">å…± {{ (collections.categoryList.length + (1 if uncategorizedCount > 0 else 0)) }} ä¸ªåˆ†ç±»</span>
    {% endif %}
  </div>
</div>

<div class="note-content">
  <!-- æ˜¾ç¤ºé¡µé¢æ­£æ–‡å†…å®¹ -->
  {% if content and content.trim() %}
    <div class="page-description">
      {{ content | safe }}
    </div>
  {% endif %}
  
  <div class="taxonomy-grid">
    {% if taxonomyType == "tags" %}
      <!-- æž„å»ºæ™®é€šæ ‡ç­¾åˆ—è¡¨ -->
      {% set normalTagItems = [] %}
      {% for tag in collections.tagList %}
        {% set tagPosts = collections.postsByTag[tag] %}
        {% if tagPosts and tagPosts.length > 0 %}
          {% set normalTagItems = normalTagItems.concat([{
            name: tag,
            count: tagPosts.length,
            url: "/tags/" + tag + "/"
          }]) %}
        {% endif %}
      {% endfor %}
      
      <!-- æŒ‰æ•°é‡å€’åºæŽ’åˆ—æ™®é€šæ ‡ç­¾ -->
      {% set sortedNormalTagItems = normalTagItems | sort(attribute="count") | reverse %}
      
      <!-- è®¡ç®—æ— æ ‡ç­¾é¡¹ï¼ŒæŽ’é™¤_index.mdæ–‡ä»¶ -->
      {% set untaggedPosts = [] %}
      {% for item in collections.content %}
        {% set fileName = item.inputPath.split('/').pop() %}
        {% if (not item.data.tags or item.data.tags.length == 0) and fileName != "_index.md" %}
          {% set untaggedPosts = untaggedPosts.concat([item]) %}
        {% endif %}
      {% endfor %}
      
      <!-- å°†æ— æ ‡ç­¾é¡¹æ·»åŠ åˆ°æœ€åŽ -->
      {% set sortedTagItems = sortedNormalTagItems %}
      {% if untaggedPosts.length > 0 %}
        {% set sortedTagItems = sortedTagItems.concat([{
          name: "æ— æ ‡ç­¾",
          count: untaggedPosts.length,
          url: "/tags/untagged/"
        }]) %}
      {% endif %}
      
      {% for item in sortedTagItems %}
        <a href="{{ item.url }}" class="taxonomy-button taxonomy-tag">
          <span class="taxonomy-icon">#</span>
          <span class="taxonomy-name">{{ item.name }}</span>
          <span class="taxonomy-count">{{ item.count }}</span>
        </a>
      {% endfor %}
      
    {% else %}
      <!-- æž„å»ºæ™®é€šåˆ†ç±»åˆ—è¡¨ -->
      {% set normalCategoryItems = [] %}
      {% for category in collections.categoryList %}
        {% set categoryPosts = collections.postsByCategory[category] %}
        {% if categoryPosts and categoryPosts.length > 0 %}
          {% set normalCategoryItems = normalCategoryItems.concat([{
            name: category,
            count: categoryPosts.length,
            url: "/categories/" + category + "/"
          }]) %}
        {% endif %}
      {% endfor %}
      
      <!-- æŒ‰æ•°é‡å€’åºæŽ’åˆ—æ™®é€šåˆ†ç±» -->
      {% set sortedNormalCategoryItems = normalCategoryItems | sort(attribute="count") | reverse %}
      
      <!-- è®¡ç®—æœªåˆ†ç±»é¡¹ï¼ŒæŽ’é™¤_index.mdæ–‡ä»¶ -->
      {% set uncategorizedPosts = [] %}
      {% for item in collections.content %}
        {% set fileName = item.inputPath.split('/').pop() %}
        {% if not item.data.category and fileName != "_index.md" %}
          {% set uncategorizedPosts = uncategorizedPosts.concat([item]) %}
        {% endif %}
      {% endfor %}
      
      <!-- å°†æœªåˆ†ç±»é¡¹æ·»åŠ åˆ°æœ€åŽ -->
      {% set sortedCategoryItems = sortedNormalCategoryItems %}
      {% if uncategorizedPosts.length > 0 %}
        {% set sortedCategoryItems = sortedCategoryItems.concat([{
          name: "æœªåˆ†ç±»",
          count: uncategorizedPosts.length,
          url: "/categories/uncategorized/"
        }]) %}
      {% endif %}
      
      {% for item in sortedCategoryItems %}
        <a href="{{ item.url }}" class="taxonomy-button taxonomy-category">
          <span class="taxonomy-icon">ðŸ“‚</span>
          <span class="taxonomy-name">{{ item.name }}</span>
          <span class="taxonomy-count">{{ item.count }}</span>
        </a>
      {% endfor %}
    {% endif %}
  </div>

  {% if taxonomyType == "tags" %}
    {% if collections.tagList.length == 0 and untaggedPosts.length == 0 %}
      <p class="no-tags-message">æš‚æ—¶è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•æ ‡ç­¾</p>
    {% endif %}
  {% else %}
    {% if collections.categoryList.length == 0 and uncategorizedPosts.length == 0 %}
      <p class="no-tags-message">æš‚æ—¶è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•åˆ†ç±»</p>
    {% endif %}
  {% endif %}
</div>